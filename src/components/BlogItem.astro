---
import { urlFor } from "@/lib/sanity";

type Props = {
  title: string;
  description: string;
  mainImage: object | null;
  publishedAt: string;
  external_link?: string;
  slug: { current: string };
  short_content: string;
};

const {
  title,
  description,
  mainImage,
  publishedAt,
  external_link,
  slug,
  short_content,
}: Props = Astro.props;

const imageUrl = () => {
  if (!mainImage) return null;
  return urlFor(mainImage).url();
};

const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
};

// Typically we want to link to the blog post, but if there is an external link, we want to link to that
// But slug url takes precedence over external link
const blogUrl = slug.current ? `/blog/${slug.current}` : external_link;
const isExternal = !!external_link;
---

<a
  href={blogUrl}
  class="flex flex-col h-48 rounded-lg group/blog-item"
  style="border: 1px solid var(--color-border); transition: border-color 0.2s ease"
  onmouseover="this.style.borderColor='var(--color-accent)'"
  onmouseout="this.style.borderColor='var(--color-border)'"
>
  <!-- <img
    src={imageUrl()}
    alt={title}
    class="w-full h-10 object-cover rounded-t-lg mb-4"
  /> -->

  <h2 class="text-xl leading-tight px-4 line-clamp-2 pt-4" style="color: var(--color-text)">
    {title}
  </h2>

  <p class="leading-relaxed mb-4 px-4 line-clamp-2" style="color: var(--color-text-muted)">{description}</p>

  <!-- short content -->
  <p class="leading-relaxed mb-4 text-sm px-4 flex-grow line-clamp-3" style="color: var(--color-text-muted)">
    {short_content}
  </p>

  <div class="flex items-center justify-between gap-2 px-4 pb-4">
    <p class="text-xs" style="color: var(--color-text-muted)">{formatDate(publishedAt)}</p>
    {
      isExternal && (
        <span class="text-xs px-1 rounded flex-shrink-0" style="border: 1px solid var(--color-border); color: var(--color-text-muted); background-color: var(--color-accent-bg)">
          ext
        </span>
      )
    }
  </div>
</a>
